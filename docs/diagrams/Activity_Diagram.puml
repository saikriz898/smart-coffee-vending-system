@startuml Activity_Diagram
!theme plain
title Coffee Order Process Activity Diagram

start

:User opens application;

if (User registered?) then (yes)
  :Login with credentials;
  if (Valid credentials?) then (yes)
    :Access granted;
  else (no)
    :Show error message;
    stop
  endif
else (no)
  :Register new account;
  :Receive $10 welcome bonus;
  :Login with new credentials;
endif

:Display user dashboard;
:Load coffee menu from database;

repeat
  :Browse coffee menu;
  :Select coffee item;
  :Customize order (size, sugar, milk);
  :Calculate item price;
  note right
    Price = Base Price Ã— Size Multiplier + Customization Fees
    Size Multipliers: Small(0.8x), Medium(1x), Large(1.3x)
    Fees: High Sugar(+$0.25), High Milk(+$0.50)
  end note
  :Add item to cart;
repeat while (Add more items?) is (yes)
-> no;

if (Cart empty?) then (yes)
  :Show empty cart message;
  stop
endif

:Calculate total amount;
:Check user balance;

if (Sufficient balance?) then (no)
  :Show insufficient balance error;
  :Offer to add balance;
  if (User adds balance?) then (yes)
    :Process balance addition;
    :Update user balance in database;
  else (no)
    stop
  endif
endif

:Create order in database;
note right
  Transaction includes:
  - Insert order record
  - Insert order items
  - Set status to PENDING
end note

if (Order creation successful?) then (no)
  :Show order creation error;
  :Rollback transaction;
  stop
endif

:Process wallet payment;
:Deduct amount from user balance;
:Update payment status to COMPLETED;
:Update order status to PREPARING;

if (Payment successful?) then (no)
  :Show payment error;
  :Rollback balance deduction;
  stop
endif

:Generate digital receipt;
:Display receipt to user;
:Clear shopping cart;
:Update balance display;
:Show success message;

fork
  :Send order to preparation queue;
  note right: Admin can track order status
fork again
  :Update inventory levels;
  note right: Deduct ingredients if implemented
fork again
  :Log transaction for reporting;
  note right: Used for daily/weekly/monthly reports
end fork

:Order processing complete;

stop

@enduml